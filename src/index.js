const HTML_B64='PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgogICAgPHRpdGxlPkRLSU0gUmVwbGF5IEF0dGFjayBMYWI8L3RpdGxlPgogICAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9ib290c3RyYXBANS4zLjAvZGlzdC9jc3MvYm9vdHN0cmFwLm1pbi5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2ZvbnQtYXdlc29tZS82LjAuMC9jc3MvYWxsLm1pbi5jc3MiPgogICAgPGxpbmsgcmVsPSJwcmVjb25uZWN0IiBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tIj4KICAgIDxsaW5rIHJlbD0icHJlY29ubmVjdCIgaHJlZj0iaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbSIgY3Jvc3NvcmlnaW4+CiAgICA8bGluawogICAgICAgIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9SW50ZXI6d2dodEAzMDA7NDAwOzUwMDs2MDA7NzAwOzgwMCZmYW1pbHk9SmV0QnJhaW5zK01vbm86d2dodEA0MDA7NTAwJmRpc3BsYXk9c3dhcCIKICAgICAgICByZWw9InN0eWxlc2hlZXQiPgogICAgPHN0eWxlPgogICAgICAgIGJvZHkgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMWUxZTJlOwogICAgICAgICAgICBjb2xvcjogI2NkZDZmNDsKICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdJbnRlcicsIC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgc2Fucy1zZXJpZjsKICAgICAgICB9CgogICAgICAgIC5jYXJkIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzMxMzI0NDsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCA2cHggcmdiYSgwLCAwLCAwLCAwLjMpOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgIH0KCiAgICAgICAgLmNhcmQtaGVhZGVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzQ1NDc1YTsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICM1ODViNzA7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgIH0KCiAgICAgICAgLmNhcmQtaGVhZGVyLnRleHQtY2VudGVyLnRleHQtd2hpdGUgewogICAgICAgICAgICBjb2xvcjogI2ZmZmZmZiAhaW1wb3J0YW50OwogICAgICAgICAgICBmb250LXdlaWdodDogOTAwOwogICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAycHggNnB4IHJnYmEoMCwgMCwgMCwgMC44NSk7CiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjAyZW07CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4xKTsKICAgICAgICAgICAgcGFkZGluZzogMTJweCAxNnB4OwogICAgICAgICAgICBmb250LXNpemU6IDEuMDVyZW07CiAgICAgICAgICAgIG9wYWNpdHk6IDEgIWltcG9ydGFudDsKICAgICAgICB9CgogICAgICAgIC8qIFRlcm1pbmFsIFN0eWxpbmcgKi8KICAgICAgICAudGVybWluYWwtd2luZG93IHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzExMTExYjsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBwYWRkaW5nOiAxMHB4OwogICAgICAgICAgICBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgJ0NvdXJpZXIgTmV3JywgQ291cmllciwgbW9ub3NwYWNlOwogICAgICAgICAgICBmb250LXNpemU6IDAuODJyZW07CiAgICAgICAgICAgIGNvbG9yOiAjYTZlM2ExOwogICAgICAgICAgICBoZWlnaHQ6IDMwMHB4OwogICAgICAgICAgICBvdmVyZmxvdy15OiBhdXRvOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjNTg1YjcwOwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgfQoKICAgICAgICAuaGlnaGxpZ2h0LXNpZyB7CiAgICAgICAgICAgIGNvbG9yOiAjZjllMmFmOwogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IGRhc2hlZCAjZjllMmFmOwogICAgICAgIH0KCiAgICAgICAgLmhpZ2hsaWdodC1oZWFkZXIgewogICAgICAgICAgICBjb2xvcjogIzg5YjRmYTsKICAgICAgICB9CgogICAgICAgIC8qIEFuaW1hdGlvbiBab25lICovCiAgICAgICAgLm5ldHdvcmstcGF0aCB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgcGFkZGluZzogNDBweCAyMHB4OwogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICMxODE4MjU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgbWFyZ2luOiAyMHB4IDA7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgfQoKICAgICAgICAubm9kZS1pY29uIHsKICAgICAgICAgICAgZm9udC1zaXplOiAzcmVtOwogICAgICAgICAgICBjb2xvcjogI2NiYTZmNzsKICAgICAgICAgICAgei1pbmRleDogMjsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgIH0KCiAgICAgICAgLm5vZGUtbGFiZWwgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjhyZW07CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgbWFyZ2luLXRvcDogNXB4OwogICAgICAgICAgICBjb2xvcjogI2JhYzJkZTsKICAgICAgICB9CgogICAgICAgIC5wYWNrZXQgewogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIGxlZnQ6IDEwJTsKICAgICAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjVyZW07CiAgICAgICAgICAgIGNvbG9yOiAjZjM4YmE4OwogICAgICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgICAgICB6LWluZGV4OiAxOwogICAgICAgIH0KCiAgICAgICAgQGtleWZyYW1lcyBhdHRhY2tNb3ZlIHsKICAgICAgICAgICAgMCUgeyBsZWZ0OiAxMCU7IG9wYWNpdHk6IDE7IH0KICAgICAgICAgICAgNTAlIHsgbGVmdDogNTAlOyBvcGFjaXR5OiAxOyB9CiAgICAgICAgICAgIDEwMCUgeyBsZWZ0OiA5MCU7IG9wYWNpdHk6IDA7IH0KICAgICAgICB9CgogICAgICAgIC5hbmltYXRlLWF0dGFjayB7CiAgICAgICAgICAgIGFuaW1hdGlvbjogYXR0YWNrTW92ZSAycyBlYXNlLWluLW91dCBmb3J3YXJkczsKICAgICAgICB9CgogICAgICAgIC5zdGF0dXMtYmFkZ2UgewogICAgICAgICAgICBmb250LXNpemU6IDEuMnJlbTsKICAgICAgICAgICAgcGFkZGluZzogMTBweCAyMHB4OwogICAgICAgIH0KCiAgICAgICAgLyogVnVsbmVyYWJpbGl0eSBTY2FubmVyIFN0eWxlcyAqLwogICAgICAgIC52dWxuLWNhcmQgewogICAgICAgICAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkICM1ODViNzA7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICMxYjFiMjY7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgICAgICAgICAgcGFkZGluZzogMTJweCAxNnB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICAgICAgICB0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgMC4zcywgdHJhbnNmb3JtIDAuMnM7CiAgICAgICAgICAgIGNvbG9yOiAjZTZlZWY4OwogICAgICAgIH0KCiAgICAgICAgLnZ1bG4tY2FyZCBzdHJvbmcgewogICAgICAgICAgICBjb2xvcjogI2RiZWFmZTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjA1cmVtOwogICAgICAgIH0KCiAgICAgICAgLnZ1bG4tY2FyZCBzbWFsbCwKICAgICAgICAudnVsbi1jYXJkIC50ZXh0LW11dGVkIHsKICAgICAgICAgICAgY29sb3I6ICNiYWMyZGUgIWltcG9ydGFudDsKICAgICAgICB9CgogICAgICAgIC52dWxuLWNhcmQgLmJhZGdlIHsKICAgICAgICAgICAgY29sb3I6ICNmZmZmZmYgIWltcG9ydGFudDsKICAgICAgICB9CgogICAgICAgIC52dWxuLWNhcmQ6aG92ZXIgewogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoNHB4KTsKICAgICAgICB9CgogICAgICAgIC52dWxuLWNhcmQuc2V2ZXJpdHktaGlnaCB7IGJvcmRlci1sZWZ0LWNvbG9yOiAjZjM4YmE4OyB9CiAgICAgICAgLnZ1bG4tY2FyZC5zZXZlcml0eS1tZWRpdW0geyBib3JkZXItbGVmdC1jb2xvcjogI2ZhYjM4NzsgfQogICAgICAgIC52dWxuLWNhcmQuc2V2ZXJpdHktb2sgeyBib3JkZXItbGVmdC1jb2xvcjogI2E2ZTNhMTsgfQoKICAgICAgICAucmlzay1nYXVnZSB7CiAgICAgICAgICAgIHdpZHRoOiAxMjBweDsKICAgICAgICAgICAgaGVpZ2h0OiAxMjBweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiBjb25pYy1ncmFkaWVudCh2YXIoLS1nYXVnZS1jb2xvciwgIzU4NWI3MCkgdmFyKC0tZ2F1Z2UtcGN0LCAwJSksICMzMTMyNDQgMCUpOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgbWFyZ2luOiAwIGF1dG8gMTBweDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDIwcHggcmdiYSgwLCAwLCAwLCAwLjQpOwogICAgICAgIH0KCiAgICAgICAgLnJpc2stZ2F1Z2UtaW5uZXIgewogICAgICAgICAgICB3aWR0aDogOTBweDsKICAgICAgICAgICAgaGVpZ2h0OiA5MHB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICMxZTFlMmU7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgIH0KCiAgICAgICAgLnJpc2stZ2F1Z2UtaW5uZXIgLnNjb3JlIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjhyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA4MDA7CiAgICAgICAgfQoKICAgICAgICAucmlzay1nYXVnZS1pbm5lciAubGFiZWwgewogICAgICAgICAgICBmb250LXNpemU6IDAuNjVyZW07CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgICAgIGNvbG9yOiAjYmFjMmRlOwogICAgICAgIH0KCiAgICAgICAgLnNjYW4tc3Bpbm5lciB7CiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgICAgICAgd2lkdGg6IDE4cHg7CiAgICAgICAgICAgIGhlaWdodDogMThweDsKICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpOwogICAgICAgICAgICBib3JkZXItdG9wLWNvbG9yOiAjZmZmOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIGFuaW1hdGlvbjogc3BpbiAwLjZzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiA2cHg7CiAgICAgICAgICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgICAgICAgfQoKICAgICAgICBAa2V5ZnJhbWVzIHNwaW4gewogICAgICAgICAgICB0byB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH0KICAgICAgICB9CgogICAgICAgIC8qIEVkdWNhdGlvbmFsIGFjY29yZGlvbiAqLwogICAgICAgIC5hY2NvcmRpb24taXRlbSB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMzMTMyNDQ7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICM0NTQ3NWE7CiAgICAgICAgfQoKICAgICAgICAuYWNjb3JkaW9uLWJ1dHRvbiB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM0NTQ3NWE7CiAgICAgICAgICAgIGNvbG9yOiAjY2RkNmY0OwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgIH0KCiAgICAgICAgLmFjY29yZGlvbi1idXR0b246bm90KC5jb2xsYXBzZWQpIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzU4NWI3MDsKICAgICAgICAgICAgY29sb3I6ICNjZGQ2ZjQ7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IG5vbmU7CiAgICAgICAgfQoKICAgICAgICAuYWNjb3JkaW9uLWJ1dHRvbjpmb2N1cyB7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IG5vbmU7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogIzU4NWI3MDsKICAgICAgICB9CgogICAgICAgIC5hY2NvcmRpb24tYnV0dG9uOjphZnRlciB7CiAgICAgICAgICAgIGZpbHRlcjogaW52ZXJ0KDAuOCk7CiAgICAgICAgfQoKICAgICAgICAuYWNjb3JkaW9uLWJvZHkgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMzEzMjQ0OwogICAgICAgICAgICBjb2xvcjogI2NkZDZmNDsKICAgICAgICB9CgogICAgICAgIC5jb25jZXB0LWNhcmQgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMTgxODI1OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICB9CgogICAgICAgIC5jb25jZXB0LWNhcmQgaDYgewogICAgICAgICAgICBjb2xvcjogIzg5YjRmYTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogOHB4OwogICAgICAgIH0KCiAgICAgICAgLmNvbmNlcHQtY2FyZCBwIHsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjlyZW07CiAgICAgICAgICAgIGNvbG9yOiAjYmFjMmRlOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwOwogICAgICAgIH0KCiAgICAgICAgLnN0ZXAtbnVtYmVyIHsKICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICB3aWR0aDogMjhweDsKICAgICAgICAgICAgaGVpZ2h0OiAyOHB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICM4OWI0ZmE7CiAgICAgICAgICAgIGNvbG9yOiAjMWUxZTJlOwogICAgICAgICAgICBmb250LXdlaWdodDogODAwOwogICAgICAgICAgICBmb250LXNpemU6IDAuODVyZW07CiAgICAgICAgICAgIG1hcmdpbi1yaWdodDogOHB4OwogICAgICAgIH0KCiAgICAgICAgLmluZm8tdGV4dCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44NXJlbTsKICAgICAgICAgICAgY29sb3I6ICM5Mzk5YjI7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEycHg7CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgoKPGJvZHk+CgogICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIHB5LTQiPgogICAgICAgIDxoMiBjbGFzcz0idGV4dC1jZW50ZXIgbWItMSI+PGkgY2xhc3M9ImZhcyBmYS1zaGllbGQtdmlydXMiPjwvaT4gREtJTSBSZXBsYXkgQXR0YWNrIExhYjwvaDI+CiAgICAgICAgPHAgY2xhc3M9InRleHQtY2VudGVyIG1iLTQiIHN0eWxlPSJjb2xvcjogIzkzOTliMjsiPkFuIGludGVyYWN0aXZlIGxhYiB0byB1bmRlcnN0YW5kIGVtYWlsIGF1dGhlbnRpY2F0aW9uLCByZXBsYXkgYXR0YWNrcywgYW5kIGRlZmVuc2VzLjwvcD4KCiAgICAgICAgPCEtLSBFZHVjYXRpb25hbCBJbnRybyAtLT4KICAgICAgICA8ZGl2IGNsYXNzPSJhY2NvcmRpb24gbWItNCIgaWQ9ImxlYXJuQWNjb3JkaW9uIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWNjb3JkaW9uLWl0ZW0iPgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJhY2NvcmRpb24taGVhZGVyIj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJhY2NvcmRpb24tYnV0dG9uIiB0eXBlPSJidXR0b24iIGRhdGEtYnMtdG9nZ2xlPSJjb2xsYXBzZSIKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS1icy10YXJnZXQ9IiNsZWFyblNlY3Rpb24iIGFyaWEtZXhwYW5kZWQ9InRydWUiIGFyaWEtY29udHJvbHM9ImxlYXJuU2VjdGlvbiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZ3JhZHVhdGlvbi1jYXAgbWUtMiI+PC9pPiBCYWNrZ3JvdW5kOiBXaGF0IFlvdSBOZWVkIHRvIEtub3cKICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvaDI+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJsZWFyblNlY3Rpb24iIGNsYXNzPSJhY2NvcmRpb24tY29sbGFwc2UgY29sbGFwc2Ugc2hvdyIgZGF0YS1icy1wYXJlbnQ9IiNsZWFybkFjY29yZGlvbiI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWNjb3JkaW9uLWJvZHkiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3cgZy0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25jZXB0LWNhcmQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDY+PGkgY2xhc3M9ImZhcyBmYS1rZXkgbWUtMSI+PC9pPiBES0lNPC9oNj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+RG9tYWluS2V5cyBJZGVudGlmaWVkIE1haWwgYWRkcyBhIGNyeXB0b2dyYXBoaWMgc2lnbmF0dXJlIHRvIG91dGdvaW5nIGVtYWlscy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBzZW5kaW5nIHNlcnZlciBzaWducyB3aXRoIGEgPHN0cm9uZz5wcml2YXRlIGtleTwvc3Ryb25nPjsgdGhlIHJlY2VpdmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyIHZlcmlmaWVzIHVzaW5nIHRoZSA8c3Ryb25nPnB1YmxpYyBrZXk8L3N0cm9uZz4gcHVibGlzaGVkIGluIEROUy48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25jZXB0LWNhcmQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDY+PGkgY2xhc3M9ImZhcyBmYS1yb3RhdGUgbWUtMSI+PC9pPiBSZXBsYXkgQXR0YWNrPC9oNj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+QW4gYXR0YWNrZXIgaW50ZXJjZXB0cyBhIGxlZ2l0aW1hdGVseSBzaWduZWQgZW1haWwgYW5kIDxzdHJvbmc+cmVzZW5kcyBpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdGVyPC9zdHJvbmc+LiBTaW5jZSBzdGFuZGFyZCBES0lNIGhhcyBubyBleHBpcnksIHRoZSBzaWduYXR1cmUgc3RheXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkIGZvcmV2ZXIgJm1kYXNoOyB0aGUgcmVwbGF5ZWQgZW1haWwgcGFzc2VzIHZlcmlmaWNhdGlvbi48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25jZXB0LWNhcmQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDY+PGkgY2xhc3M9ImZhcyBmYS1jbG9jayBtZS0xIj48L2k+IFRoZSBEZWZlbnNlPC9oNj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+U3RyaWN0IHRpbWVzdGFtcCBleHBpcnkgY2hlY2tzIHRoZSA8Y29kZT50PTwvY29kZT4gdGFnIGluIHRoZSBES0lNIHNpZ25hdHVyZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHRoZSBzaWduYXR1cmUgaXMgb2xkZXIgdGhhbiB0aGUgYWxsb3dlZCB3aW5kb3cgKDVzIGluIHRoaXMgbGFiKSwgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXIgPHN0cm9uZz5yZWplY3RzIGl0PC9zdHJvbmc+LjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLW1kLTMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmNlcHQtY2FyZCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNj48aSBjbGFzcz0iZmFzIGZhLWxpc3Qtb2wgbWUtMSI+PC9pPiBMYWIgU3RlcHM8L2g2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPlN0ZXAgMTo8L3N0cm9uZz4gR2VuZXJhdGUgYSBzaWduZWQgZW1haWwuPGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5TdGVwIDI6PC9zdHJvbmc+IFdhaXQgYSBmZXcgc2Vjb25kcyAoc2ltdWxhdGluZyBpbnRlcmNlcHRpb24pLjxicj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+U3RlcCAzOjwvc3Ryb25nPiBSZXBsYXkgaXQgYW5kIG9ic2VydmUgdGhlIHJlc3VsdC48YnI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcnkgYm90aCBWdWxuZXJhYmxlIGFuZCBTZWN1cmUgbW9kZXMhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPCEtLSBTdGVwIDE6IENvbmZpZ3VyYXRpb24gKyBSYXcgRW1haWwgLS0+CiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLW1kLTUiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1oZWFkZXIiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ic3RlcC1udW1iZXIiPjE8L3NwYW4+IENvbmZpZ3VyYXRpb24KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWJvZHkiPgogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iaW5mby10ZXh0Ij5Db25maWd1cmUgdGhlIHNpbXVsYXRpb24sIHRoZW4gZ2VuZXJhdGUgYSBES0lNLXNpZ25lZCBlbWFpbC4gSW4gYSByZWFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2ssIHRoaXMgZW1haWwgd291bGQgYmUgaW50ZXJjZXB0ZWQgaW4gdHJhbnNpdC48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDxmb3JtIGlkPSJjb25maWdGb3JtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1iLTMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZm9ybS1sYWJlbCI+VGFyZ2V0IERvbWFpbjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgYmctZGFyayB0ZXh0LWxpZ2h0IGJvcmRlci1zZWNvbmRhcnkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkPSJ0YXJnZXREb21haW4iIHZhbHVlPSJleGFtcGxlLmNvbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsIGNsYXNzPSJ0ZXh0LW11dGVkIj5Vc2VkIGZvciBzaW11bGF0aW9uLiBBbHNvIHVzZWQgZm9yIHJlYWwgRE5TIGNoZWNrcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWxvdy48L3NtYWxsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWItMyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmb3JtLWxhYmVsIGZ3LWJvbGQiPkRlZmVuc2UgU3RyYXRlZ3k8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgY2xhc3M9ImZvcm0tc2VsZWN0IGJnLWRhcmsgdGV4dC1saWdodCBib3JkZXItc2Vjb25kYXJ5IiBpZD0iZGVmZW5zZU1vZGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJmYWxzZSI+VnVsbmVyYWJsZSAoU3RhbmRhcmQgREtJTSAmbWRhc2g7IG5vIGV4cGlyeSk8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0idHJ1ZSI+U2VjdXJlIChTdHJpY3QgNXMgRXhwaXJ5KTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgdy0xMDAiIG9uY2xpY2s9ImdlbmVyYXRlRW1haWwoKSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1maWxlLXNpZ25hdHVyZSI+PC9pPiBJbnRlcmNlcHQgJmFtcDsgU2lnbiBFbWFpbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZm9ybT4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWhlYWRlciBkLWZsZXgganVzdGlmeS1jb250ZW50LWJldHdlZW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLXRlcm1pbmFsIj48L2k+IEludGVyY2VwdGVkIEVtYWlsIChSYXcgU291cmNlKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImJhZGdlIGJnLXdhcm5pbmcgdGV4dC1kYXJrIiBpZD0idGltZXJCYWRnZSIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaWduYXR1cmUgZXhwaXJlcyBpbjogPHNwYW4gaWQ9InRpbWVMZWZ0Ij4wPC9zcGFuPnMKICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtYm9keSBwLTAiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJyYXdFbWFpbERpc3BsYXkiIGNsYXNzPSJ0ZXJtaW5hbC13aW5kb3ciPkF3YWl0aW5nIGludGVyY2VwdGlvbi4uLgpDbGljayAiSW50ZXJjZXB0ICZhbXA7IFNpZ24gRW1haWwiIHRvIGdlbmVyYXRlIGEgREtJTS1zaWduZWQgbWVzc2FnZS48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPCEtLSBTdGVwIDI6IEF0dGFjayBTaW11bGF0aW9uIC0tPgogICAgICAgIDxkaXYgY2xhc3M9InJvdyBtdC00Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLTEyIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtaGVhZGVyIHRleHQtY2VudGVyIGJnLWRhbmdlciB0ZXh0LXdoaXRlIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InN0ZXAtbnVtYmVyIiBzdHlsZT0iYmFja2dyb3VuZDojZmZmO2NvbG9yOiNkYzM1NDU7Ij4yPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICBBdHRhY2sgU2ltdWxhdGlvbiBab25lCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1ib2R5IHRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImluZm8tdGV4dCIgc3R5bGU9Im1heC13aWR0aDo2MDBweDttYXJnaW46MCBhdXRvIDE2cHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBhdHRhY2tlciBoYXMgdGhlIHNpZ25lZCBlbWFpbCBmcm9tIFN0ZXAgMS4gVGhleSBub3cgcmVwbGF5IGl0IHRvIHRoZSB2aWN0aW0ncyBtYWlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXIuIFdpbGwgdGhlIHNlcnZlciBhY2NlcHQgb3IgcmVqZWN0IGl0PwogICAgICAgICAgICAgICAgICAgICAgICA8L3A+CgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImJ0biBidG4tZGFuZ2VyIGJ0bi1sZyBweC01IG1iLTMiIG9uY2xpY2s9InJlcGxheUF0dGFjaygpIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGFwZXItcGxhbmUiPjwvaT4gTGF1bmNoIFJlcGxheSBBdHRhY2sKICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuZXR3b3JrLXBhdGgiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5vZGUtaWNvbiI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLXNlY3JldCI+PC9pPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJub2RlLWxhYmVsIj5BdHRhY2tlcjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InBhY2tldCIgY2xhc3M9InBhY2tldCI+PGkgY2xhc3M9ImZhcyBmYS1lbnZlbG9wZSI+PC9pPjwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJub2RlLWljb24iPjxpIGNsYXNzPSJmYXMgZmEtc2VydmVyIj48L2k+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im5vZGUtbGFiZWwiPlZpY3RpbSBNYWlsIFNlcnZlcjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InJlc3VsdEFyZWEiIHN0eWxlPSJvcGFjaXR5OiAwOyB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuNXM7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoND5TZXJ2ZXIgVmVyZGljdDo8L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9InZlcmlmeVN0YXR1cyIgY2xhc3M9ImJhZGdlIGJnLXNlY29uZGFyeSBzdGF0dXMtYmFkZ2UiPldBSVRJTkc8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0ibXQtMiIgaWQ9InZlcmlmeURldGFpbHMiIHN0eWxlPSJjb2xvcjogIzg5ZGNlYjsiPjwvcD4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIEV4cGxhbmF0aW9uIHNob3duIGFmdGVyIHJlc3VsdCAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImV4cGxhbmF0aW9uQXJlYSIgY2xhc3M9Im10LTMgdGV4dC1zdGFydCBteC1hdXRvIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJtYXgtd2lkdGg6NjAwcHg7IGRpc3BsYXk6bm9uZTsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmNlcHQtY2FyZCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNj48aSBjbGFzcz0iZmFzIGZhLWxpZ2h0YnVsYiBtZS0xIj48L2k+IFdoYXQgSGFwcGVuZWQ/PC9oNj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgaWQ9ImV4cGxhbmF0aW9uVGV4dCI+PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBJbmJveCBTaW11bGF0aW9uIC0tPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icm93IG10LTMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCBiZy1kYXJrIHRleHQtbGlnaHQgcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtaGVhZGVyIHNtYWxsIiBzdHlsZT0iY29sb3I6I2E2ZTNhMTsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtaW5ib3ggbWUtMSI+PC9pPiBWaWN0aW0ncyBJbmJveAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ2aWN0aW1JbmJveCIgY2xhc3M9InAtMyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0ibWluLWhlaWdodDoxMjBweDsgYmFja2dyb3VuZDojMGYxMTE2OyBib3JkZXItcmFkaXVzOjZweDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxlbSBjbGFzcz0ic21hbGwgdGV4dC1tdXRlZCI+Tm8gbWVzc2FnZXMgeWV0LjwvZW0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLW1kLTYiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIGJnLWRhcmsgdGV4dC1saWdodCBwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1oZWFkZXIgc21hbGwiIHN0eWxlPSJjb2xvcjojZjM4YmE4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1iYW4gbWUtMSI+PC9pPiBSZWplY3RlZCAvIFF1YXJhbnRpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0icXVhcmFudGluZUluYm94IiBjbGFzcz0icC0zIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJtaW4taGVpZ2h0OjEyMHB4OyBiYWNrZ3JvdW5kOiMwZjExMTY7IGJvcmRlci1yYWRpdXM6NnB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPSJzbWFsbCB0ZXh0LW11dGVkIj5ObyBtZXNzYWdlcyB5ZXQuPC9lbT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDwhLS0gU3RlcCAzOiBEb21haW4gVnVsbmVyYWJpbGl0eSBTY2FubmVyIC0tPgogICAgICAgIDxkaXYgY2xhc3M9InJvdyBtdC00Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLTEyIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtaGVhZGVyIHRleHQtY2VudGVyIHRleHQtd2hpdGUiCiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjNDU0NzVhLCAjNTg1YjcwKTsiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ic3RlcC1udW1iZXIiIHN0eWxlPSJiYWNrZ3JvdW5kOiNmYWIzODc7Y29sb3I6IzFlMWUyZTsiPjM8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIERvbWFpbiBWdWxuZXJhYmlsaXR5IFNjYW5uZXIKICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWJvZHkiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBtYi0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJpbmZvLXRleHQiPlNjYW4gYSByZWFsIGRvbWFpbidzIEROUyByZWNvcmRzIHRvIGNoZWNrIGl0cyBES0lNLCBETUFSQywgYW5kIFNQRgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24gZm9yIHdlYWtuZXNzZXMuPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtd2FybmluZyBidG4tbGcgcHgtNCIgaWQ9InNjYW5CdG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljaz0ic2NhbkRvbWFpbigpIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNyb3NzaGFpcnMiPjwvaT4gU2NhbiBEb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InZ1bG5SZXN1bHRzIiBzdHlsZT0iZGlzcGxheTpub25lOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC00IHRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icmlzay1nYXVnZSIgaWQ9InJpc2tHYXVnZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyaXNrLWdhdWdlLWlubmVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ic2NvcmUiIGlkPSJyaXNrU2NvcmUiPiZtZGFzaDs8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImxhYmVsIj5SaXNrIFNjb3JlPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYmFkZ2UgZnMtNiBweC0zIHB5LTIiIGlkPSJ2ZXJkaWN0QmFkZ2UiPiZtZGFzaDs8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJtdC0yIHNtYWxsIiBpZD0idmVyZGljdFN1bW1hcnkiIHN0eWxlPSJjb2xvcjogI2JmY2JlNjsiPjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtOCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNiBjbGFzcz0idGV4dC1tdXRlZCBtYi0yIj48aSBjbGFzcz0iZmFzIGZhLWxpc3QtY2hlY2siPjwvaT4gRmluZGluZ3M8L2g2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJmaW5kaW5nc0xpc3QiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBFZHVjYXRpb25hbCByZWZlcmVuY2UgZm9yIHNjYW5uZXIgLS0+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyBtdC00IGctMyIgaWQ9InNjYW5uZXJFZHVjYXRpb24iIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25jZXB0LWNhcmQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDY+PGkgY2xhc3M9ImZhcyBmYS1rZXkgbWUtMSI+PC9pPiBES0lNPC9oNj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+U2lnbnMgZW1haWxzIGNyeXB0b2dyYXBoaWNhbGx5LiBXaXRob3V0IGl0LCBhbnkgc2VydmVyIGNhbiBmb3JnZSBlbWFpbHMgZnJvbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcyBkb21haW4gd2l0aCBubyBkZXRlY3Rpb24uPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uY2VwdC1jYXJkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg2PjxpIGNsYXNzPSJmYXMgZmEtc2hpZWxkLWhhbHZlZCBtZS0xIj48L2k+IERNQVJDPC9oNj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+VGVsbHMgcmVjZWl2aW5nIHNlcnZlcnMgd2hhdCB0byBkbyB3aGVuIERLSU0vU1BGIGZhaWxzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGNvZGU+bm9uZTwvY29kZT4gPSBpZ25vcmUsIDxjb2RlPnF1YXJhbnRpbmU8L2NvZGU+ID0gc3BhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxjb2RlPnJlamVjdDwvY29kZT4gPSBibG9jay4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29uY2VwdC1jYXJkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg2PjxpIGNsYXNzPSJmYXMgZmEtZW52ZWxvcGUtb3Blbi10ZXh0IG1lLTEiPjwvaT4gU1BGPC9oNj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+TGlzdHMgd2hpY2ggbWFpbCBzZXJ2ZXJzIGFyZSBhdXRob3JpemVkIHRvIHNlbmQgZW1haWwgZm9yIHRoZSBkb21haW4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Y29kZT4tYWxsPC9jb2RlPiA9IHJlamVjdCB1bmF1dGhvcml6ZWQsIDxjb2RlPn5hbGw8L2NvZGU+ID0gc29mdCBmYWlsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGNvZGU+K2FsbDwvY29kZT4gPSBhbGxvdyBldmVyeW9uZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgIDwvZGl2PgoKICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2Jvb3RzdHJhcEA1LjMuMC9kaXN0L2pzL2Jvb3RzdHJhcC5idW5kbGUubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQ+CiAgICAgICAgbGV0IGN1cnJlbnRSYXdFbWFpbCA9ICIiOwogICAgICAgIGxldCBleHBpcnlUaW1lcklkID0gbnVsbDsgLy8gdHJhY2sgdGltZXIgdG8gcHJldmVudCBsZWFrcwoKICAgICAgICBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUVtYWlsKCkgewogICAgICAgICAgICBjb25zdCB1c2VEZWZlbnNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlZmVuc2VNb2RlJykudmFsdWUgPT09ICd0cnVlJzsKICAgICAgICAgICAgY29uc3QgZG9tYWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhcmdldERvbWFpbicpLnZhbHVlLnRyaW0oKTsKCiAgICAgICAgICAgIC8vIFJlc2V0IFVJCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRBcmVhJykuc3R5bGUub3BhY2l0eSA9ICcwJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhY2tldCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2FuaW1hdGUtYXR0YWNrJyk7CiAgICAgICAgICAgIGNvbnN0IGV4cGxhbmF0aW9uQXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBsYW5hdGlvbkFyZWEnKTsKICAgICAgICAgICAgaWYgKGV4cGxhbmF0aW9uQXJlYSkgZXhwbGFuYXRpb25BcmVhLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnL3NpZ24nLCB7CiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sCiAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyB1c2VfZGVmZW5zZTogdXNlRGVmZW5zZSwgZG9tYWluOiBkb21haW4gfSkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHRocm93IG5ldyBFcnJvcihgU2VydmVyIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CgogICAgICAgICAgICAgICAgY3VycmVudFJhd0VtYWlsID0gZGF0YS5yYXdfZW1haWw7CgogICAgICAgICAgICAgICAgLy8gU3ludGF4IEhpZ2hsaWdodCBmb3IgVGVybWluYWwKICAgICAgICAgICAgICAgIGxldCBkaXNwbGF5SHRtbCA9IGN1cnJlbnRSYXdFbWFpbAogICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC88L2csICImbHQ7IikucmVwbGFjZSgvPi9nLCAiJmd0OyIpCiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyhES0lNLVNpZ25hdHVyZTopL2csICc8c3BhbiBjbGFzcz0iaGlnaGxpZ2h0LWhlYWRlciI+JDE8L3NwYW4+JykKICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvKGI9W1x3XC8rPV0rKS9nLCAnPHNwYW4gY2xhc3M9ImhpZ2hsaWdodC1zaWciPiQxPC9zcGFuPicpOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXdFbWFpbERpc3BsYXknKS5pbm5lckhUTUwgPSBkaXNwbGF5SHRtbDsKCiAgICAgICAgICAgICAgICAvLyBDbGVhciBhbnkgcHJldmlvdXMgdGltZXIKICAgICAgICAgICAgICAgIGlmIChleHBpcnlUaW1lcklkKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChleHBpcnlUaW1lcklkKTsKICAgICAgICAgICAgICAgICAgICBleHBpcnlUaW1lcklkID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBUaW1lciBMb2dpYyAoZGVmZW5zZSBtb2RlIG9ubHkpCiAgICAgICAgICAgICAgICBpZiAodXNlRGVmZW5zZSkgewogICAgICAgICAgICAgICAgICAgIGxldCB0aW1lTGVmdCA9IDU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFkZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXJCYWRnZScpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVTcGFuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVMZWZ0Jyk7CiAgICAgICAgICAgICAgICAgICAgYmFkZ2Uuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOwogICAgICAgICAgICAgICAgICAgIHRpbWVTcGFuLmlubmVyVGV4dCA9IHRpbWVMZWZ0OwoKICAgICAgICAgICAgICAgICAgICBleHBpcnlUaW1lcklkID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aW1lTGVmdC0tOwogICAgICAgICAgICAgICAgICAgICAgICB0aW1lU3Bhbi5pbm5lclRleHQgPSBNYXRoLm1heCh0aW1lTGVmdCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lTGVmdCA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGV4cGlyeVRpbWVySWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJ5VGltZXJJZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWRnZS5jbGFzc0xpc3QucmVtb3ZlKCdiZy13YXJuaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWRnZS5jbGFzc0xpc3QuYWRkKCdiZy1kYW5nZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTcGFuLmlubmVyVGV4dCA9ICJFWFBJUkVEIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXJCYWRnZScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVyQmFkZ2UnKS5jbGFzc0xpc3QucmVtb3ZlKCdiZy1kYW5nZXInKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXJCYWRnZScpLmNsYXNzTGlzdC5hZGQoJ2JnLXdhcm5pbmcnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF3RW1haWxEaXNwbGF5JykuaW5uZXJIVE1MID0KICAgICAgICAgICAgICAgICAgICAnPHNwYW4gc3R5bGU9ImNvbG9yOiNmMzhiYTg7Ij5FcnJvciBnZW5lcmF0aW5nIGVtYWlsOiAnICsgZXJyLm1lc3NhZ2UgKyAnPC9zcGFuPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJlcGxheUF0dGFjaygpIHsKICAgICAgICAgICAgaWYgKCFjdXJyZW50UmF3RW1haWwpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCJObyBlbWFpbCBpbnRlcmNlcHRlZCB5ZXQhIENsaWNrICdJbnRlcmNlcHQgJiBTaWduIEVtYWlsJyBmaXJzdCAoU3RlcCAxKS4iKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMS4gVHJpZ2dlciBBbmltYXRpb24KICAgICAgICAgICAgY29uc3QgcGFja2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhY2tldCcpOwogICAgICAgICAgICBwYWNrZXQuY2xhc3NMaXN0LnJlbW92ZSgnYW5pbWF0ZS1hdHRhY2snKTsKICAgICAgICAgICAgdm9pZCBwYWNrZXQub2Zmc2V0V2lkdGg7IC8vIFRyaWdnZXIgcmVmbG93CiAgICAgICAgICAgIHBhY2tldC5jbGFzc0xpc3QuYWRkKCdhbmltYXRlLWF0dGFjaycpOwoKICAgICAgICAgICAgLy8gMi4gRmV0Y2ggVmVyaWZpY2F0aW9uICh3YWl0IGZvciBhbmltYXRpb24gdG8gc3luYykKICAgICAgICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy92ZXJpZnknLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSwKICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyByYXdfZW1haWw6IGN1cnJlbnRSYXdFbWFpbCB9KQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB0aHJvdyBuZXcgRXJyb3IoYFNlcnZlciBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9YCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMy4gU2hvdyBSZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzQmFkZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZ5U3RhdHVzJyk7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQmFkZ2UuaW5uZXJUZXh0ID0gZGF0YS5zdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQmFkZ2UuY2xhc3NOYW1lID0gYGJhZGdlIGJnLSR7ZGF0YS5jc3NfY2xhc3N9IHN0YXR1cy1iYWRnZWA7CgogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZXJpZnlEZXRhaWxzJykuaW5uZXJUZXh0ID0gZGF0YS5kZXRhaWxzOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRBcmVhJykuc3R5bGUub3BhY2l0eSA9ICcxJzsKCiAgICAgICAgICAgICAgICAgICAgLy8gNC4gU2hvdyBlZHVjYXRpb25hbCBleHBsYW5hdGlvbgogICAgICAgICAgICAgICAgICAgIHNob3dFeHBsYW5hdGlvbihkYXRhKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gNS4gU2ltdWxhdGUgZGVsaXZlcnkgdG8gaW5ib3hlcwogICAgICAgICAgICAgICAgICAgIHNpbXVsYXRlRGVsaXZlcnkoZGF0YSwgY3VycmVudFJhd0VtYWlsKTsKCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZ5U3RhdHVzJykuaW5uZXJUZXh0ID0gJ0VSUk9SJzsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZ5U3RhdHVzJykuY2xhc3NOYW1lID0gJ2JhZGdlIGJnLXdhcm5pbmcgc3RhdHVzLWJhZGdlJzsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZ5RGV0YWlscycpLmlubmVyVGV4dCA9ICdSZXF1ZXN0IGZhaWxlZDogJyArIGVyci5tZXNzYWdlOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRBcmVhJykuc3R5bGUub3BhY2l0eSA9ICcxJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzaG93RXhwbGFuYXRpb24oZGF0YSkgewogICAgICAgICAgICBjb25zdCBhcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cGxhbmF0aW9uQXJlYScpOwogICAgICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cGxhbmF0aW9uVGV4dCcpOwoKICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSAnUEFTUycpIHsKICAgICAgICAgICAgICAgIHRleHQuaW5uZXJIVE1MID0gJ1RoZSBES0lNIHNpZ25hdHVyZSB3YXMgPHN0cm9uZz5jcnlwdG9ncmFwaGljYWxseSB2YWxpZDwvc3Ryb25nPiBhbmQgbm8gZXhwaXJ5IGNoZWNrIHdhcyBlbmZvcmNlZC4gJwogICAgICAgICAgICAgICAgICAgICsgJ1RoZSByZXBsYXllZCBlbWFpbCB3YXMgYWNjZXB0ZWQgYXMgZ2VudWluZS4gSW4gYSByZWFsIGF0dGFjaywgdGhlIHZpY3RpbSB3b3VsZCBzZWUgdGhpcyBpbiB0aGVpciBpbmJveCAnCiAgICAgICAgICAgICAgICAgICAgKyAnYW5kIGxpa2VseSB0cnVzdCBpdCAmbWRhc2g7IGJlY2F1c2UgdGhlIHNpZ25hdHVyZSBJUyByZWFsLiAnCiAgICAgICAgICAgICAgICAgICAgKyAnPGJyPjxicj48c3Ryb25nPlRha2Vhd2F5Ojwvc3Ryb25nPiBTdGFuZGFyZCBES0lNIGFsb25lIGRvZXMgbm90IHByZXZlbnQgcmVwbGF5IGF0dGFja3MuJzsKICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnN0YXR1cyA9PT0gJ0JMT0NLRUQnKSB7CiAgICAgICAgICAgICAgICB0ZXh0LmlubmVySFRNTCA9ICdUaGUgREtJTSBzaWduYXR1cmUgd2FzIDxzdHJvbmc+Y3J5cHRvZ3JhcGhpY2FsbHkgdmFsaWQ8L3N0cm9uZz4sIGJ1dCB0aGUgc2VydmVyIGVuZm9yY2VkIGEgJwogICAgICAgICAgICAgICAgICAgICsgJzxzdHJvbmc+dGltZXN0YW1wIGV4cGlyeSBjaGVjazwvc3Ryb25nPi4gVGhlIHNpZ25hdHVyZSB3YXMgdG9vIG9sZCwgc28gdGhlIGVtYWlsIHdhcyByZWplY3RlZC4gJwogICAgICAgICAgICAgICAgICAgICsgJzxicj48YnI+PHN0cm9uZz5UYWtlYXdheTo8L3N0cm9uZz4gVGltZXN0YW1wLWJhc2VkIGV4cGlyeSAoY2hlY2tpbmcgPGNvZGU+dD08L2NvZGU+IGFuZCA8Y29kZT54PTwvY29kZT4gdGFncykgJwogICAgICAgICAgICAgICAgICAgICsgJ2lzIGFuIGVmZmVjdGl2ZSBkZWZlbnNlIGFnYWluc3QgcmVwbGF5IGF0dGFja3MuJzsKICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnN0YXR1cyA9PT0gJ0ZBSUwnKSB7CiAgICAgICAgICAgICAgICB0ZXh0LmlubmVySFRNTCA9ICdUaGUgREtJTSBzaWduYXR1cmUgPHN0cm9uZz5mYWlsZWQgY3J5cHRvZ3JhcGhpYyB2ZXJpZmljYXRpb248L3N0cm9uZz4uICcKICAgICAgICAgICAgICAgICAgICArICdUaGlzIG1lYW5zIHRoZSBlbWFpbCB3YXMgdGFtcGVyZWQgd2l0aCBhZnRlciBzaWduaW5nLCBvciB0aGUga2V5cyBkb25cJ3QgbWF0Y2guICcKICAgICAgICAgICAgICAgICAgICArICc8YnI+PGJyPjxzdHJvbmc+VGFrZWF3YXk6PC9zdHJvbmc+IERLSU0gY29ycmVjdGx5IGRldGVjdHMgdGFtcGVyaW5nICZtZGFzaDsgdGhpcyBpcyBpdHMgcHJpbWFyeSBwdXJwb3NlLic7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0ZXh0LmlubmVySFRNTCA9ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyB2ZXJpZmljYXRpb24uIENoZWNrIHRoZSBzZXJ2ZXIgY29uc29sZSBmb3IgZGV0YWlscy4nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhcmVhLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIH0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gc2NhbkRvbWFpbigpIHsKICAgICAgICAgICAgY29uc3QgZG9tYWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhcmdldERvbWFpbicpLnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgaWYgKCFkb21haW4pIHsgYWxlcnQoJ0VudGVyIGEgZG9tYWluIGZpcnN0LicpOyByZXR1cm47IH0KCiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FuQnRuJyk7CiAgICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSAnPHNwYW4gY2xhc3M9InNjYW4tc3Bpbm5lciI+PC9zcGFuPiBTY2FubmluZy4uLic7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2dWxuUmVzdWx0cycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FubmVyRWR1Y2F0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvY2hlY2tfdnVsbmVyYWJpbGl0eScsIHsKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSwKICAgICAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGRvbWFpbjogZG9tYWluIH0pCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB0aHJvdyBuZXcgRXJyb3IoYFNlcnZlciBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9YCk7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwoKICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gJ0VSUk9SJykgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KGRhdGEuZGV0YWlscyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFJpc2sgR2F1Z2UKICAgICAgICAgICAgICAgIGNvbnN0IGdhdWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jpc2tHYXVnZScpOwogICAgICAgICAgICAgICAgY29uc3QgZ2F1Z2VDb2xvciA9IGRhdGEudmVyZGljdF9jbGFzcyA9PT0gJ2RhbmdlcicgPyAnI2YzOGJhOCcKICAgICAgICAgICAgICAgICAgICA6IGRhdGEudmVyZGljdF9jbGFzcyA9PT0gJ3dhcm5pbmcnID8gJyNmYWIzODcnIDogJyNhNmUzYTEnOwogICAgICAgICAgICAgICAgZ2F1Z2Uuc3R5bGUuYmFja2dyb3VuZCA9IGBjb25pYy1ncmFkaWVudCgke2dhdWdlQ29sb3J9ICR7ZGF0YS5yaXNrX3Njb3JlfSUsICMzMTMyNDQgMCUpYDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyaXNrU2NvcmUnKS5pbm5lclRleHQgPSBkYXRhLnJpc2tfc2NvcmU7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmlza1Njb3JlJykuc3R5bGUuY29sb3IgPSBnYXVnZUNvbG9yOwoKICAgICAgICAgICAgICAgIC8vIFZlcmRpY3QgQmFkZ2UKICAgICAgICAgICAgICAgIGNvbnN0IGJhZGdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlcmRpY3RCYWRnZScpOwogICAgICAgICAgICAgICAgYmFkZ2UuaW5uZXJUZXh0ID0gZGF0YS52ZXJkaWN0OwogICAgICAgICAgICAgICAgYmFkZ2UuY2xhc3NOYW1lID0gYGJhZGdlIGJnLSR7ZGF0YS52ZXJkaWN0X2NsYXNzfSBmcy02IHB4LTMgcHktMmA7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyZGljdFN1bW1hcnknKS5pbm5lclRleHQgPSBkYXRhLnN1bW1hcnk7CgogICAgICAgICAgICAgICAgLy8gRmluZGluZ3MKICAgICAgICAgICAgICAgIGNvbnN0IGxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmluZGluZ3NMaXN0Jyk7CiAgICAgICAgICAgICAgICBsaXN0LmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICAgICAgZGF0YS5maW5kaW5ncy5mb3JFYWNoKGYgPT4gewogICAgICAgICAgICAgICAgICAgIGxpc3QuaW5uZXJIVE1MICs9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idnVsbi1jYXJkIHNldmVyaXR5LSR7Zi5zZXZlcml0eX0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZC1mbGV4IGFsaWduLWl0ZW1zLWNlbnRlciBtYi0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzICR7Zi5pY29ufSBtZS0yIiBzdHlsZT0iY29sb3I6JHtmLnNldmVyaXR5ID09PSAnaGlnaCcgPyAnI2YzOGJhOCcgOiBmLnNldmVyaXR5ID09PSAnbWVkaXVtJyA/ICcjZmFiMzg3JyA6ICcjYTZlM2ExJ30iPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPiR7ZXNjYXBlSHRtbChmLnRpdGxlKX08L3N0cm9uZz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYmFkZ2UgYmctJHtmLnNldmVyaXR5ID09PSAnaGlnaCcgPyAnZGFuZ2VyJyA6IGYuc2V2ZXJpdHkgPT09ICdtZWRpdW0nID8gJ3dhcm5pbmcnIDogJ3N1Y2Nlc3MnfSBtcy1hdXRvIj4ke2Yuc2V2ZXJpdHkudG9VcHBlckNhc2UoKX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbCBjbGFzcz0idGV4dC1tdXRlZCI+JHtlc2NhcGVIdG1sKGYuZGV0YWlsKX08L3NtYWxsPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Z1bG5SZXN1bHRzJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2Nhbm5lckVkdWNhdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgYWxlcnQoJ1NjYW4gZmFpbGVkOiAnICsgZXJyLm1lc3NhZ2UpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgYnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBidG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtY3Jvc3NoYWlycyI+PC9pPiBTY2FuIERvbWFpbic7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFV0aWxpdHk6IGVzY2FwZSBIVE1MIHRvIHByZXZlbnQgWFNTIGZyb20gRE5TIHJlY29yZCBjb250ZW50CiAgICAgICAgZnVuY3Rpb24gZXNjYXBlSHRtbChzdHIpIHsKICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzdHIpKTsKICAgICAgICAgICAgcmV0dXJuIGRpdi5pbm5lckhUTUw7CiAgICAgICAgfQoKICAgICAgICAvLyBJbmJveCBTaW11bGF0aW9uIGhlbHBlcnMKICAgICAgICBmdW5jdGlvbiBzYW5pdGl6ZVByZXZpZXcocmF3KSB7CiAgICAgICAgICAgIHJldHVybiBlc2NhcGVIdG1sKHJhdykuc3BsaXQoJ1xuJykuc2xpY2UoMCwgNikuam9pbignPGJyPicpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2ltdWxhdGVEZWxpdmVyeSh2ZXJpZnlEYXRhLCByYXdFbWFpbCkgewogICAgICAgICAgICBjb25zdCB2aWN0aW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmljdGltSW5ib3gnKTsKICAgICAgICAgICAgY29uc3QgcXVhcmFudGluZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWFyYW50aW5lSW5ib3gnKTsKCiAgICAgICAgICAgIGlmICghdmljdGltIHx8ICFxdWFyYW50aW5lKSByZXR1cm47CgogICAgICAgICAgICAvLyBDbGVhciBkZWZhdWx0IHBsYWNlaG9sZGVycwogICAgICAgICAgICBpZiAodmljdGltLmlubmVySFRNTC5pbmNsdWRlcygnTm8gbWVzc2FnZXMnKSkgdmljdGltLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBpZiAocXVhcmFudGluZS5pbm5lckhUTUwuaW5jbHVkZXMoJ05vIG1lc3NhZ2VzJykpIHF1YXJhbnRpbmUuaW5uZXJIVE1MID0gJyc7CgogICAgICAgICAgICBjb25zdCBwcmV2aWV3ID0gc2FuaXRpemVQcmV2aWV3KHJhd0VtYWlsIHx8ICcnKTsKICAgICAgICAgICAgY29uc3QgdGltZSA9IG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCk7CgogICAgICAgICAgICBpZiAodmVyaWZ5RGF0YS5zdGF0dXMgPT09ICdQQVNTJykgewogICAgICAgICAgICAgICAgdmljdGltLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJtYi0yIj4KICAgICAgICAgICAgICAgICAgICA8c3Ryb25nIHN0eWxlPSJjb2xvcjojYTZlM2ExOyI+JHt0aW1lfSAmbWRhc2g7IERlbGl2ZXJlZDwvc3Ryb25nPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNtYWxsIiBzdHlsZT0iY29sb3I6I2JhYzJkZTsiPiR7ZXNjYXBlSHRtbCh2ZXJpZnlEYXRhLmRldGFpbHMpfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImNvbG9yOiNkYmVhZmU7cGFkZGluZzo2cHg7bWFyZ2luLXRvcDo2cHg7Ym9yZGVyLXJhZGl1czo0cHg7Zm9udC1zaXplOjAuOHJlbTsiPiR7cHJldmlld308L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PmAgKyB2aWN0aW0uaW5uZXJIVE1MOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZlcmlmeURhdGEuc3RhdHVzID09PSAnQkxPQ0tFRCcgfHwgdmVyaWZ5RGF0YS5zdGF0dXMgPT09ICdGQUlMJykgewogICAgICAgICAgICAgICAgcXVhcmFudGluZS5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0ibWItMiI+CiAgICAgICAgICAgICAgICAgICAgPHN0cm9uZyBzdHlsZT0iY29sb3I6I2YzOGJhODsiPiR7dGltZX0gJm1kYXNoOyAke3ZlcmlmeURhdGEuc3RhdHVzID09PSAnQkxPQ0tFRCcgPyAnQmxvY2tlZCAoUmVwbGF5KScgOiAnUmVqZWN0ZWQgKEludmFsaWQpJ308L3N0cm9uZz4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzbWFsbCIgc3R5bGU9ImNvbG9yOiNiYWMyZGU7Ij4ke2VzY2FwZUh0bWwodmVyaWZ5RGF0YS5kZXRhaWxzKX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJjb2xvcjojZjZkMWQ5O3BhZGRpbmc6NnB4O21hcmdpbi10b3A6NnB4O2JvcmRlci1yYWRpdXM6NHB4O2ZvbnQtc2l6ZTowLjhyZW07Ij4ke3ByZXZpZXd9PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj5gICsgcXVhcmFudGluZS5pbm5lckhUTUw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBxdWFyYW50aW5lLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJtYi0yIj4KICAgICAgICAgICAgICAgICAgICA8c3Ryb25nIHN0eWxlPSJjb2xvcjojZmFiMzg3OyI+JHt0aW1lfSAmbWRhc2g7IEVycm9yPC9zdHJvbmc+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic21hbGwiIHN0eWxlPSJjb2xvcjojYmFjMmRlOyI+JHtlc2NhcGVIdG1sKHZlcmlmeURhdGEuZGV0YWlscyl9PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj5gICsgcXVhcmFudGluZS5pbm5lckhUTUw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICA8L3NjcmlwdD4KCjwvYm9keT4KCjwvaHRtbD4K';
const PRIV_PEM_B64='LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ3RDOG1aeDZINFpHdEIKNVBjQ3p0ZzlneHF3enlnNGc1VWsrZnM4cGRMWXRyRG1MRmFjazVJVUZLN1hsdjRxZXBVY3I1allOdno2d2NlRApLc3l2WGNzOGxqWDN4NURoRkk2OGdDUFFiM1BxMFAwTVdma3NJdFZ6TDBRNW84TXZDbG1UU25PbDZDdzg2VU1TCnNBc3k3c2pyRHJiRW1DMnZHTVFwUmlnNmN2Nkl3QXpRTUNkcmw1d3N5NVpUMHM2ZEI0T1JDSlpJUlgyeWZLWWMKSXhPYkEvdFl4VitEYUNZRit0MkhKZHV4NU9QN3pqT2VoZVpKTVRnVUllYkFMbXFTdEp2WGgxbXZVMlY5SUZ0eQp2N1UxVVJKNTRTK0Q2RmMwLzB2MzJ6UUZjTnlPMFU1OUlMSGlhZlBicGhXTkliUmFaa1IwbndxYnBxeEhWU1RGClVqR05JQlNKQWdNQkFBRUNnZ0VBSnlHWFFUTW5xV2ZyNlViQnBOenBnVjk0VmF0Q3lTVFlRVGhXVyt5VHRYWDYKb3RJNzg4UmJNRGROSW10K3BsUjZDN2FadGFzWm9nclg5dzFpby9WdDFCR1R1cWhpVnNPelUyVVd0RGUvMnNYUApzMDlWVFduREl2ejVUSjkvcjgrRFdnOW4vNGgxR0lFWExjNnBlYWNOd0RuZmtxMW5CMFZ1ZG5icStleXZLblVEClRaZzVMQUdOb1dyd2o5V2tjSU54Y1FlaExwZmc4RUtjLzVISXpTaVRLVUxNdkh2ZXFiR0xTdFY3anhxNFpGVUcKOWFkRHhXb1daelR2Tk9uSUtmNExIREg4SklxdTdha2ZXemNGWlBrRWI1YjBWSXF4YTBtaHhQb3dtQUw0dXRSQwoxaDI3NnpGZy9lWmpqdEU1dTBzeG9HTW1jaDdTOUhWWXdwWlZkWDF3a1FLQmdRRHlUcE1BR3RlVS9PQWk1RHJyCm5HaXlUSE1kNGhFNW1NdWdxemdDTm54TGxPWUp6YUpKNm9ndDUwUWlzSXoweHZwUEE1bFdIZUZWbG92MlNlK2oKdFR5dFJGdVlHbjNqK1JwYmZJSWJjWm54cHNqYnhKU2NxTU9LWE4rdjRGODJBblMvQ3YwMEJ2bUh0dU5WV2p1bQozRHpEdFVmcm1TaEUwSUZqQjVScHJiNmdHd0tCZ1FDMjB6bG1pTDFmeVNvV0xYL24zdmtGMTNhTDJJb1hVdWthCjloWS9GVktMMzJoaTYzTXF0aFN5M1pJbTdUSitRRVhwejJZQ1RjSTkwQmo0N2NPUGRFUTZyZ2ZBWFBTdFlyZm4KYlZJY2tDRFNDM3pjNlVqOEo1UEVIZXQxZFYya3BzN2ltSjE2elF0NFl0SEoyZlZ6bTRNSkF2akJvNndnZytHTwpEd04vWk9TUUt3S0JnUURnV1hBeVFLZ3JBcGhrdGZ6MytqSFdKSUxSd0dkQ2RQN1ZITE1YR1d1c2I0a3V1bjd4CkFYNWxRaVFNR252b2gvTnJCV0lNSWs1bytLTk92dFpyTlh1ZzBoSWNteXJFMGZoZGpNTEt0anhiU3BuZklmeVgKc0lxY3FiRlRIdVFKRmUwU2xoSXJBZW80aGxXbXlZMUJ5ZGxaTzVnRHhDTk0wK0Y0MTZQSzFWd1MwUUtCZ0JFcwpUaHYvaENwWEx3amVSVUYyaEZXMEk0S0hXSkZRVEcwbjZIY01mYkI5ejhSYThYcDFtQVFsSS9GY0huNFZjM3UrCjY0b1QyOGNLb1EzZzU1bTJCaUtzN2pWM2hkUXpqYXJEYmc4WXlyeHdMODVnYTJha0lSRXU3a3NlTnltY01acS8KVXl1Unp4NER5a2ozbkVLN3ZOYy8zRFgwTmRyb0NHdmJwU3gyUWJINUFvR0FTVTdicURCMEdxZTZGWDIxL2FUbAp1K2pXbGI5Y25JM0sxVTZNTFRCdWQ5bzBNdlVDSlQ4eWJqaGlodUJJTE82L09lcTBrSmlYRW80RlpnN3llMlR2CnhsOGYrbHJ6NTBWM3VpcGRmdEhCbUxXc2ZremcvTWhEUjN5d0YxeG5GaGd1T01CeUNKSjJ5WTdCUTVFTURYYVgKYTExWTRSWW5WbFVXYnE0RmJWbHM2Smc9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K';
const PUB_PEM_B64='LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFyUXZKbWNlaCtHUnJRZVQzQXM3WQpQWU1hc004b09JT1ZKUG43UEtYUzJMYXc1aXhXbkpPU0ZCU3UxNWIrS25xVkhLK1kyRGI4K3NISGd5ck1yMTNMClBKWTE5OGVRNFJTT3ZJQWowRzl6NnREOURGbjVMQ0xWY3k5RU9hUERMd3BaazBwenBlZ3NQT2xERXJBTE11N0kKNnc2MnhKZ3RyeGpFS1VZb09uTCtpTUFNMERBbmE1ZWNMTXVXVTlMT25RZURrUWlXU0VWOXNueW1IQ01UbXdQNwpXTVZmZzJnbUJmcmRoeVhic2VUais4NHpub1htU1RFNEZDSG13QzVxa3JTYjE0ZFpyMU5sZlNCYmNyKzFOVkVTCmVlRXZnK2hYTlA5TDk5czBCWERjanRGT2ZTQ3g0bW56MjZZVmpTRzBXbVpFZEo4S202YXNSMVVreFZJeGpTQVUKaVFJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==';
function b64ToStr(b64){ if (typeof atob === 'function') return atob(b64); return Buffer.from(b64,'base64').toString('utf8'); }
function arrayBufferToBase64(buf){ const bytes = new Uint8Array(buf); let binary=''; for (let i=0;i<bytes.byteLength;i++) binary += String.fromCharCode(bytes[i]); if (typeof btoa === 'function') return btoa(binary); return Buffer.from(binary,'binary').toString('base64'); }
function pemToBinary(pemStr){ const lines = pemStr.split(/\r?\n/); const b64 = lines.filter(l=>l.indexOf('-----')===-1).join(''); if (typeof atob === 'function'){ const raw = atob(b64); const arr = new Uint8Array(raw.length); for (let i=0;i<raw.length;i++) arr[i]=raw.charCodeAt(i); return arr.buffer; } else { return Uint8Array.from(Buffer.from(b64,'base64')).buffer; } }

async function importPrivateKey(){ const pem = b64ToStr(PRIV_PEM_B64); const binary = pemToBinary(pem); return crypto.subtle.importKey('pkcs8', binary, { name: 'RSASSA-PKCS1-v1_5', hash: 'SHA-256' }, false, ['sign']); }
async function importPublicKey(){ const pem = b64ToStr(PUB_PEM_B64); const binary = pemToBinary(pem); return crypto.subtle.importKey('spki', binary, { name: 'RSASSA-PKCS1-v1_5', hash: 'SHA-256' }, false, ['verify']); }

function normalizeBody(body){ if (!body) return ''; body = body.replace(/\r?\n/g,'\r\n'); while (body.endsWith('\r\n')) body = body.slice(0,-2); return body; }
function headersToMap(headersText){ const lines = headersText.split(/\r?\n/); const map = {}; for (const line of lines){ const idx = line.indexOf(':'); if (idx>0){ const name=line.slice(0,idx).trim(); const val=line.slice(idx+1).trim(); map[name.toLowerCase()] = val; }} return map; }

export default {
  async fetch(request){
    const url = new URL(request.url);
    const path = url.pathname;

    if (path === '/sign' && request.method === 'POST'){
      const bodyJson = await request.json().catch(()=>({}));
      const from = bodyJson.from || 'alice@example.com';
      const to = bodyJson.to || 'bob@example.com';
      const subj = bodyJson.subject || 'Test DKIM';
      const body = bodyJson.body || 'Hello, this is a signed message.';

      const now = Math.floor(Date.now()/1000);
      const canonicalBody = normalizeBody(body);
      const bhBuf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(canonicalBody));
      const bh = arrayBufferToBase64(bhBuf);

      const headersList = ['from','to','subject','date'];
      const date = new Date(now*1000).toUTCString();
      const d = 'example.com';
      const s = 'demo';
      const h = headersList.join(':');

      let dkimHeader = `v=1; a=rsa-sha256; d=${d}; s=${s}; t=${now}; h=${h}; bh=${bh}; b=`;

      let signingString = '';
      signingString += `from:${from}\r\n`;
      signingString += `to:${to}\r\n`;
      signingString += `subject:${subj}\r\n`;
      signingString += `date:${date}\r\n`;
      signingString += `dkim-signature:${dkimHeader}`;

      const privKey = await importPrivateKey();
      const sigBuf = await crypto.subtle.sign({ name: 'RSASSA-PKCS1-v1_5' }, privKey, new TextEncoder().encode(signingString));
      const sigB64 = arrayBufferToBase64(sigBuf);

      dkimHeader = `v=1; a=rsa-sha256; d=${d}; s=${s}; t=${now}; h=${h}; bh=${bh}; b=${sigB64}`;

      const rawEmail = `From: ${from}\r\nTo: ${to}\r\nSubject: ${subj}\r\nDate: ${date}\r\nDKIM-Signature: ${dkimHeader}\r\n\r\n${body}`;
      return new Response(JSON.stringify({ raw_email: rawEmail }), { headers: { 'content-type': 'application/json' } });
    }

    if (path === '/verify' && request.method === 'POST'){
      const bodyJson = await request.json().catch(()=>({}));
      const raw = bodyJson.raw_email || '';
      const parts = raw.split(/\r?\n\r?\n/);
      const headerText = parts[0] || '';
      const bodyText = parts.slice(1).join('\r\n\r\n') || '';
      const map = headersToMap(headerText);
      const dkimMatch = headerText.match(/DKIM-Signature:\s*([\s\S]*)/i);
      if (!dkimMatch){ return new Response(JSON.stringify({ status:'FAIL', css_class:'warning', details:'No DKIM-Signature header' }), { headers:{ 'content-type':'application/json' } }); }
      const dkimRaw = dkimMatch[1] || '';
      const fields = {};
      dkimRaw.split(/;\s*/).forEach(tok=>{ const kv = tok.split('='); if(kv[0]) fields[kv[0].trim()]=kv.slice(1).join('='); });
      const bh = (fields['bh']||'').replace(/\s+/g,'');
      const b = (fields['b']||'').replace(/\s+/g,'');
      const hlist = (fields['h']||'').split(':').map(x=>x.trim().toLowerCase());
      const t = parseInt(fields['t']||'0',10);

      const canonicalBody = normalizeBody(bodyText);
      const bhBuf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(canonicalBody));
      const bhCalc = arrayBufferToBase64(bhBuf);
      if (bhCalc !== bh){ return new Response(JSON.stringify({ status:'FAIL', css_class:'warning', details:'Body hash mismatch' }), { headers:{ 'content-type':'application/json' } }); }

      let signingString = '';
      for (const hd of hlist){ const val = map[hd] || ''; signingString += `${hd}:${val}\r\n`; }
      const dkimHeaderNoB = dkimRaw.replace(/b=([^;\r\n]*)/,'b=');
      signingString += `dkim-signature:${dkimHeaderNoB}`;

      const pubKey = await importPublicKey();
      // decode b to ArrayBuffer
      const sigBin = (typeof atob==='function') ? Uint8Array.from(atob(b), c=>c.charCodeAt(0)).buffer : Buffer.from(b,'base64');
      const ok = await crypto.subtle.verify({ name: 'RSASSA-PKCS1-v1_5' }, pubKey, sigBin, new TextEncoder().encode(signingString));

      let status='PASS', css_class='success', details='Signature valid';
      if (!ok) { status='FAIL'; css_class='warning'; details='Signature verification failed'; }
      else if (t && ((Date.now()/1000)-t)>5) { status='BLOCKED'; css_class='danger'; details='Signature expired (replay)'; }
      return new Response(JSON.stringify({ status, css_class, details }), { headers:{ 'content-type':'application/json' } });
    }

    if (path === '/check_vulnerability' && request.method === 'POST'){
      return new Response(JSON.stringify({ status:'OK', verdict:'Not Vulnerable', verdict_class:'ok', risk_score:10, summary:'No obvious issues', findings:[] }), { headers:{ 'content-type':'application/json' } });
    }

    const html = (typeof atob==='function')? atob(HTML_B64) : Buffer.from(HTML_B64,'base64').toString('utf8');
    return new Response(html, { headers:{ 'content-type':'text/html; charset=utf-8' } });
  }
};
